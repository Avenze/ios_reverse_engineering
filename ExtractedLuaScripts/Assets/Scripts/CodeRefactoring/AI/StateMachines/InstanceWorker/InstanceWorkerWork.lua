---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by GXY.
--- DateTime: 2023/9/1 13:57
---
local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")
local CfgMgr = GameTableDefine.ConfigMgr
local InstanceDataManager = GameTableDefine.InstanceDataManager
local InstanceModel = GameTableDefine.InstanceModel
local InstanceAIBlackBoard = GameTableDefine.InstanceAIBlackBoard
local UIView = require("Framework.UI.View") -- 当工具类使用
local Random = CS.UnityEngine.Random
local Vector3 = CS.UnityEngine.Vector3
local UnityHelper = CS.Common.Utils.UnityHelper
local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")



---@class InstanceWorkerWork:AIStateBase
---@field m_owner InstanceWorkerClass
local InstanceWorkerWork = Class("InstanceWorkerWork",AIStateBase)

function InstanceWorkerWork:ctor()

end

function InstanceWorkerWork:OnEnter(...)
    local actor = self.m_owner
    local actorData = actor.data
    local stateMachine = actor.m_stateMachine
    -- 初始化在工作点
    if not actorData.workPosTr or actorData.workPosTr:IsNull() then
        actorData.furGO = InstanceModel:GetSceneRoomFurnitureGo(actorData.roomId ,actorData.furIndex)
        actorData.workPosTr = UIView:GetTrans(actorData.furGO, "workPos") --工位点
        actorData.workFaceTr = UIView:GetTrans(actorData.furGO, "face") --工位点朝向
        actorData.actPosTr = UIView:GetTrans(actorData.roomGO, "actionPos/actionPos_" .. actorData.furIndex) or actorData.workPosTr --工位点
        actorData.actFaceTr = UIView:GetTrans(actorData.roomGO, "actionPos/actionPos_" .. actorData.furIndex .. "/face") or UIView:GetTrans(actorData.furGO, "face") --工位点

    end
    local face = actorData.actFaceTr
    
    actor.gameObject.transform.position = actorData.actPosTr.position
    UnityHelper.RotateTowards(actor.gameObject.transform, Vector3(face.position.x, actorData.actPosTr.position.y, face.position.z))

    -- 播放动画
    local furLevelCfg = InstanceModel:GetFurlevelConfigByRoomFurIndex(actorData.roomID, actorData.furnitureIndex)
    actor:SetAnimator(PERSON_ACTION[furLevelCfg.action])
    -- 显示气泡
    actor:SetTheDisplayOfBubbles("product")

end

function InstanceWorkerWork:OnExit()

end

return InstanceWorkerWork