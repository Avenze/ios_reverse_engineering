---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by chenlongfa.
--- DateTime: 2023/9/6 11:38
---
local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
---@class EmployeeStandUpState:AIStateBase
---@field m_owner CompanyEmployeeNew
local EmployeeStandUpState = Class("EmployeeStandUpState",AIStateBase)

local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")
local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")

function EmployeeStandUpState:ctor()
end

function EmployeeStandUpState:OnEnter(...)
    local action = PERSON_ACTION.SIT2IDLE
    local keyFrames = {{}}
    keyFrames[1].key = "ANIM_SIT2IDLE_END"
    keyFrames[1].func = handler(self,self.OnStandUpAnimOver)
    self.m_owner:SetAnimator(action, keyFrames)
end

function EmployeeStandUpState:OnExit()
end

function EmployeeStandUpState:OnStandUpAnimOver()
    if not self.m_owner.m_go or self.m_owner.m_go:IsNull() then
        return
    end
    if self.m_owner:HasFlag(ActorDefine.Flag.FLAG_EMPLOYEE_DISMISS) then
        --解雇
        self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.EmployeeDismissState)
    elseif self.m_owner:HasFlag(ActorDefine.Flag.FLAG_EMPLOYEE_ON_ACTION) then
        --去房间交互 娱乐 厕所 会议 等等
        self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.EmployeeGoToToiletState)
    elseif self.m_owner:HasFlag(ActorDefine.Flag.FLAG_EMPLOYEE_OFF_WORKING) then
        --下班
        if self.m_owner.m_stateMachine:PreStateIsState("EmployeeWorkState") then
            self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.EmployeeOffWorkState)
        else
            self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.EmployeeGoToWorkState)
        end
    else
        --回工位上班
        self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.EmployeeGoToWorkState)
    end
end

return EmployeeStandUpState