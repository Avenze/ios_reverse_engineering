---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by chenlongfa.
--- DateTime: 2025/2/8 16:30
---

local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
---@class CEOGoToWorkState:AIStateBase
---@field m_owner CEOActor
---走或跑去工位，然后进入WorkState
local CEOGoToWorkState = Class("CEOGoToWorkState",AIStateBase)

local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")
local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")
local CfgMgr = GameTableDefine.ConfigMgr

function CEOGoToWorkState:ctor()
    self.m_isMoving = true
end

function CEOGoToWorkState:OnEnter(...)
    self.m_isMoving = true
    local isRun = select(1,...) and true or false
    self:MoveToWorkSpace(isRun)
end

function CEOGoToWorkState:MoveToWorkSpace(isRun)
    local destination = self.m_owner.m_targetPosition
    local speed = isRun and CfgMgr.config_global.character_run_v or CfgMgr.config_global.character_walk_v
    self.m_owner:RandomElevatorMoveTo(destination,self.m_owner.m_targetRotation,function()
        self.m_isMoving = false
        self:DoSit()
    end,speed)
end

function CEOGoToWorkState:DoSit()
    local action = PERSON_ACTION.IDLE2SIT
    local keyFrames = {{}}
    keyFrames[1].key = "ANIM_IDLE2SIT_END"
    keyFrames[1].func = function()
        self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.CEOWorkState)
    end
    self.m_owner:SetAnimator(action, keyFrames)
end

function CEOGoToWorkState:OnExit()
    self.m_owner:StopMove()
end

return CEOGoToWorkState