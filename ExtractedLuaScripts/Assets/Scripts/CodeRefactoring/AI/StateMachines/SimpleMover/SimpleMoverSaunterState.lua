---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by chenlongfa.
--- DateTime: 2023/8/29 11:37
---
local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
---@class SimpleMoverSaunterState:AIStateBase
---@field m_owner SimpleMoverNew
local SimpleMoverSaunterState = Class("SimpleMoverSaunterState",AIStateBase)

local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")
local FloorMode = GameTableDefine.FloorMode
local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")
local CfgMgr = GameTableDefine.ConfigMgr
local Timer = GameTimer
local UnityHelper = CS.Common.Utils.UnityHelper

local WalkAnims = {
    [CfgMgr.config_global.character_walk_v] = PERSON_ACTION.WALK,
    [CfgMgr.config_global.Batman_walkspeed] = PERSON_ACTION.WALK,
    [CfgMgr.config_global.character_run_v] = PERSON_ACTION.RUN,
}

function SimpleMoverSaunterState:ctor()
    self.m_timerID = nil
end

function SimpleMoverSaunterState:OnEnter(...)
    self:DoIdleAnim()
    local waitTime = math.random(3,10)
    self.m_timerID = Timer:CreateNewTimer(waitTime,function()
        self.m_timerID = nil
        self:DoMove()
    end)
end

---@private
---移动到目标点
function SimpleMoverSaunterState:DoMove()
    local scene = FloorMode:GetScene()
    if not scene then
        return
    end
    local destination = scene:GetOnePlace()
    local hitPos,findResult = UnityHelper.SamplePositionByNavMesh(destination,9,1)
    self.m_owner:RandomElevatorMoveTo(hitPos,nil,function()
        self.m_owner.m_stateMachine:ChangeState(ActorDefine.State.SimpleMoverSaunterState)
    end,self.m_owner.m_moveSpeed)
end

---@private
---播放Idle动画
function SimpleMoverSaunterState:DoIdleAnim()
    self.m_owner:SetAnimator(PERSON_ACTION.IDLE)
end

function SimpleMoverSaunterState:OnExit()
    if self.m_timerID then
        GameTimer:StopTimer(self.m_timerID)
    end
    self.m_owner:StopMove()
end

function SimpleMoverSaunterState:OnDestroy()
    if self.m_timerID then
        Timer:StopTimer(self.m_timerID)
        self.m_timerID = nil
    end
end

function SimpleMoverSaunterState:Event(msg, params)
end

return SimpleMoverSaunterState