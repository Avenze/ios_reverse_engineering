---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Microsoft-GXY.
--- DateTime: 2024/8/16 12:28
---
local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")
local Random = CS.UnityEngine.Random
local ActorManager = GameTableDefine.ActorManager ---@type ActorManager
local CycleNightClubAIBlackBoard = GameTableDefine.CycleNightClubAIBlackBoard ---@type CycleNightClubAIBlackBoard
local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")
local ConfigMgr = GameTableDefine.ConfigMgr

local WALK_SPEED = 5.5
local RUN_SPEED = 10


---@class CycleNightClubClientLeave:AIStateBase
---@field m_owner CycleNightClubClient
local CycleNightClubClientLeave = Class("CycleNightClubClientLeave",AIStateBase)

function CycleNightClubClientLeave:ctor()

end

function CycleNightClubClientLeave:OnEnter(...)
    local actor = self.m_owner

    EventDispatcher:TriggerEvent("NIGHT_CLUB_CLIENT_LEAVE")
    actor:SetAnimator(PERSON_ACTION.WALK)
    CycleNightClubAIBlackBoard:ModifyInClubClientNum(-1)
    
    local speed = ConfigMgr.config_global.character_walk_v + Random.Range(-1.1, 1.1)
    local midPos = CycleNightClubAIBlackBoard:GetRandomOutPos()
    actor.m_animator:Play(ActorDefine.AnimationNames.Walk)

    actor:CalculatePath(
            midPos.transform,
            true,
            speed,
            Random.Range(1.1, 4.1),
            function()
                actor:Destroy()
            end
    )

end

function CycleNightClubClientLeave:OnExit()

end

return CycleNightClubClientLeave