---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Microsoft-GXY.
--- DateTime: 2024/8/16 12:28
---
local Class = require("Framework.Lua.Class")
local AIStateBase = require("CodeRefactoring.AI.StateMachines.AIStateBase")
local ActorDefine = require("CodeRefactoring.Actor.ActorDefine")
local PERSON_ACTION = require("CodeRefactoring.Actor.PersonActionDefine")
local UIView = require("Framework.UI.View") -- 当工具类使用
local CycleInstanceDataManager = GameTableDefine.CycleInstanceDataManager
local Vector3 = CS.UnityEngine.Vector3
local UnityHelper = CS.Common.Utils.UnityHelper
local Random = CS.UnityEngine.Random
local ActorManager = GameTableDefine.ActorManager ---@type ActorManager
local CycleCastleAIBlackBoard = GameTableDefine.CycleCastleAIBlackBoard ---@type CycleCastleAIBlackBoard


local WALK_SPEED = 5.5
local RUN_SPEED = 10


---@class CycleCastleClientGetUp:AIStateBase
---@field m_owner CycleCastleWorker
local CycleCastleClientGetUp = Class("CycleCastleClientGetUp",AIStateBase)

function CycleCastleClientGetUp:ctor()
    self.timer = nil
end

function CycleCastleClientGetUp:OnEnter(...)
    local actor = self.m_owner
    local actorData = actor.data
    local stateMachine = actor.m_stateMachine

    -- 播放动画
    actor:PlayAnima("disappear")

    -- 播放完成后切换状态
    local animator = UIView:GetComp(actor.gameObject, "", "Animator")
    --遍历所有的AnimationClip查找匹配的动画
    local stateName = string.gsub(animator.runtimeAnimatorController.name, "%(Clone%)", "") .. "_disappear"
    local clipLength = UnityHelper.GetAnimatorClipLength(animator, stateName)

    self.timer = GameTimer:CreateNewTimer(clipLength, function()
        if not actorData.leader then
            stateMachine:ChangeState(ActorDefine.CycleInstanceState.CycleCastleClientLeave)
        else
            stateMachine:ChangeState(ActorDefine.CycleInstanceState.CycleCastleClientFollow)
        end
    end)
end

function CycleCastleClientGetUp:OnExit()
    if self.timer then
        GameTimer:StopTimer(self.timer)
        self.timer = nil
    end
end


function CycleCastleClientGetUp:OnDestroy()
    self:OnExit()
end


return CycleCastleClientGetUp