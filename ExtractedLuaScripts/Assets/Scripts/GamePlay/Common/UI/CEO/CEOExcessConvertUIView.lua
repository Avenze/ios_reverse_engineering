---
--- Generated by Asset/Editor/Utils/LuaGenerator/LuaUIGenerator.cs
--- Created by chenlongfa
--- DateTime: 2025/2/24 17:11
---

local Class = require("Framework.Lua.Class")
local UIView = require("Framework.UI.View")
---@class CEOExcessConvertUIView:UIBaseView
local CEOExcessConvertUIView = Class("CeoExcessConvertUIView", UIView)

local EventManager = require("Framework.Event.Manager")
local CEODataManager = GameTableDefine.CEODataManager
local ResourceManger = GameTableDefine.ResourceManger

function CEOExcessConvertUIView:ctor()
    self.super:ctor()
end

function CEOExcessConvertUIView:OnEnter()
end

function CEOExcessConvertUIView:Init(ceoID)
    local cardNum =  CEODataManager:GetCurCEOCardsNum(ceoID)
    local cardPrice = CEODataManager:NeedTransformCEOCardToDiamond(ceoID)
    self:SetText("RootPanel/info/diamond/numBg/num",tostring(cardNum * cardPrice))

    local confirmBtn = self:GetComp("RootPanel/info/confirmBtn","Button")
    self:SetButtonClickHandler(confirmBtn,function()
        local curCardNum =  CEODataManager:GetCurCEOCardsNum(ceoID)
        if curCardNum > 0 and cardPrice > 0 then
            local diamondCount = cardPrice * curCardNum
            CEODataManager:ClearCurCEOCards(ceoID)
            ResourceManger:AddDiamond(diamondCount, nil, function()
                EventManager:DispatchEvent("FLY_ICON", nil, 3, nil)
                GameSDKs:TrackForeign("virtual_currency", {currency_type = 1, pos = "ceo满级补偿", behaviour = 1, num_new = tonumber(diamondCount)})
            end,true)
        end
        self:DestroyModeUIObject()
    end)
end

function CEOExcessConvertUIView:OnExit()
    self.super:OnExit(self)
end

return CEOExcessConvertUIView